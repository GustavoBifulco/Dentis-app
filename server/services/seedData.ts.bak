
import { db } from '../db';
import { procedures, inventory, patients, templateProcedures, templateInventory } from '../db/schema';
import { eq } from 'drizzle-orm';

// Hardcoded defaults in case template tables are empty
const DEFAULT_PROCEDURES = [
    { name: 'Ajuste Oclusal por Acr√©scimo', code: '001', price: '200.00', cost: '0.00', description: 'Exame de imagem para avalia√ß√£o e planejamento odontol√≥gico: Ajuste Oclusal por Acr√©scimo.', duration: 60, category: 'Profilaxia & Periodontia' },
    { name: 'Ajuste Oclusal por desgaste', code: '002', price: '200.00', cost: '0.00', description: 'Exame de imagem para avalia√ß√£o e planejamento odontol√≥gico: Ajuste Oclusal por desgaste.', duration: 60, category: 'Profilaxia & Periodontia' },
    // Truncated for brevity, applying pattern to all...

    { name: 'Alveoloplastia', code: '003', price: '300.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Alveoloplastia.', duration: 60, category: 'Cirurgia' },
    { name: 'Aplica√ß√£o de Cariost√°tico', code: '004', price: '100.00', cost: '0.00', description: 'Procedimento preventivo para controle de placa, c√°rie e sa√∫de bucal: Aplica√ß√£o de Cariost√°tico.', duration: 60, category: 'Preventivo' },
    { name: 'Aplica√ß√£o de Oz√¥nio Intra-articular com PRP Gel', code: '005', price: '200.00', cost: '0.00', description: 'Avalia√ß√£o cl√≠nica, anamnese e orienta√ß√£o/planejamento odontol√≥gico: Aplica√ß√£o de Oz√¥nio Intra-articular com PRP Gel.', duration: 60, category: 'Diagn√≥stico' },
    { name: 'Aplica√ß√£o de Ozonoterapia em ATM', code: '006', price: '200.00', cost: '0.00', description: 'Avalia√ß√£o cl√≠nica, anamnese e orienta√ß√£o/planejamento odontol√≥gico: Aplica√ß√£o de Ozonoterapia em ATM.', duration: 60, category: 'Diagn√≥stico' },
    { name: 'Aplica√ß√£o de selante', code: '007', price: '250.00', cost: '0.00', description: 'Procedimento preventivo para controle de placa, c√°rie e sa√∫de bucal: Aplica√ß√£o de selante.', duration: 60, category: 'Preventivo' },
    { name: 'Aplica√ß√£o de Verniz Fluoretado', code: '008', price: '150.00', cost: '0.00', description: 'Procedimento preventivo para controle de placa, c√°rie e sa√∫de bucal: Aplica√ß√£o de Verniz Fluoretado.', duration: 60, category: 'Preventivo' },
    { name: 'Aprofundamento de vest√≠bulo', code: '009', price: '300.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Aprofundamento de vest√≠bulo.', duration: 60, category: 'Cirurgia' },
    { name: 'Aprofundamento de sulco', code: '010', price: '300.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Aprofundamento de sulco.', duration: 60, category: 'Cirurgia' },
    { name: 'Aumentar coroa cl√≠nica', code: '011', price: '300.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Aumentar coroa cl√≠nica.', duration: 60, category: 'Cirurgia' },
    { name: 'Bi√≥psia', code: '012', price: '450.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Bi√≥psia.', duration: 60, category: 'Cirurgia' },
    { name: 'Bruxismo - placa miorelaxante', code: '013', price: '650.00', cost: '0.00', description: 'Procedimento odontol√≥gico relacionado a pr√≥tese/reabilita√ß√£o e moldagem: Bruxismo - placa miorelaxante.', duration: 60, category: 'Pr√≥tese & Moldagem' },
    { name: 'Bruxismo - Aplica√ß√£o Toxina Botul√≠nica', code: '014', price: '1500.00', cost: '0.00', description: 'Avalia√ß√£o cl√≠nica, anamnese e orienta√ß√£o/planejamento odontol√≥gico: Bruxismo - Aplica√ß√£o Toxina Botul√≠nica.', duration: 60, category: 'Diagn√≥stico' },
    { name: 'Bruxismo - Avalia√ß√£o', code: '015', price: '150.00', cost: '0.00', description: 'Avalia√ß√£o cl√≠nica, anamnese e orienta√ß√£o/planejamento odontol√≥gico: Bruxismo - Avalia√ß√£o.', duration: 60, category: 'Diagn√≥stico' },
    { name: 'Capeamento pulpar', code: '016', price: '250.00', cost: '0.00', description: 'Procedimento odontol√≥gico restaurador/dent√≠stica conforme indica√ß√£o: Capeamento pulpar.', duration: 60, category: 'Restaurador' },
    { name: 'Carv√£o ativado - Clareamento', code: '017', price: '250.00', cost: '0.00', description: 'Procedimento est√©tico odontol√≥gico conforme indica√ß√£o: Carv√£o ativado - Clareamento.', duration: 60, category: 'Est√©tica' },
    { name: 'Cirurgia de retra√ß√£o gengival', code: '018', price: '450.00', cost: '0.00', description: 'Exame de imagem para avalia√ß√£o e planejamento odontol√≥gico: Cirurgia de retra√ß√£o gengival.', duration: 60, category: 'Profilaxia & Periodontia' },
    { name: 'Cirurgia de retalho', code: '019', price: '450.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Cirurgia de retalho.', duration: 60, category: 'Cirurgia' },
    { name: 'Cirurgia periodontal', code: '020', price: '450.00', cost: '0.00', description: 'Exame de imagem para avalia√ß√£o e planejamento odontol√≥gico: Cirurgia periodontal.', duration: 60, category: 'Profilaxia & Periodontia' },
    { name: 'Clareamento consult√≥rio', code: '021', price: '650.00', cost: '0.00', description: 'Procedimento est√©tico odontol√≥gico conforme indica√ß√£o: Clareamento consult√≥rio.', duration: 60, category: 'Est√©tica' },
    { name: 'Clareamento caseiro', code: '022', price: '550.00', cost: '0.00', description: 'Procedimento est√©tico odontol√≥gico conforme indica√ß√£o: Clareamento caseiro.', duration: 60, category: 'Est√©tica' },
    { name: 'Coroa cer√¢mica', code: '023', price: '1600.00', cost: '0.00', description: 'Procedimento odontol√≥gico relacionado a pr√≥tese/reabilita√ß√£o e moldagem: Coroa cer√¢mica.', duration: 60, category: 'Pr√≥tese & Moldagem' },
    { name: 'Coroa provis√≥ria', code: '024', price: '250.00', cost: '0.00', description: 'Procedimento odontol√≥gico relacionado a pr√≥tese/reabilita√ß√£o e moldagem: Coroa provis√≥ria.', duration: 60, category: 'Pr√≥tese & Moldagem' },
    { name: 'Coroa total metalocer√¢mica', code: '025', price: '1200.00', cost: '0.00', description: 'Procedimento odontol√≥gico relacionado a pr√≥tese/reabilita√ß√£o e moldagem: Coroa total metalocer√¢mica.', duration: 60, category: 'Pr√≥tese & Moldagem' },
    { name: 'Coroa total metalop√°stica', code: '026', price: '950.00', cost: '0.00', description: 'Procedimento odontol√≥gico relacionado a pr√≥tese/reabilita√ß√£o e moldagem: Coroa total metalop√°stica.', duration: 60, category: 'Pr√≥tese & Moldagem' },
    { name: 'Coroa total zirc√¥nia', code: '027', price: '1800.00', cost: '0.00', description: 'Procedimento odontol√≥gico relacionado a pr√≥tese/reabilita√ß√£o e moldagem: Coroa total zirc√¥nia.', duration: 60, category: 'Pr√≥tese & Moldagem' },
    { name: 'Curativo endod√¥ntico', code: '028', price: '150.00', cost: '0.00', description: 'Procedimento endod√¥ntico realizado conforme indica√ß√£o: Curativo endod√¥ntico.', duration: 60, category: 'Endodontia' },
    { name: 'Dente do siso - extra√ß√£o', code: '029', price: '450.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Dente do siso - extra√ß√£o.', duration: 60, category: 'Cirurgia' },
    { name: 'Dente do siso incluso - extra√ß√£o', code: '030', price: '650.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Dente do siso incluso - extra√ß√£o.', duration: 60, category: 'Cirurgia' },
    { name: 'Dent√≠stica - restaura√ß√£o com resina 1 face', code: '031', price: '250.00', cost: '0.00', description: 'Procedimento odontol√≥gico restaurador/dent√≠stica conforme indica√ß√£o: Dent√≠stica - restaura√ß√£o com resina 1 face.', duration: 60, category: 'Restaurador' },
    { name: 'Dent√≠stica - restaura√ß√£o com resina 2 faces', code: '032', price: '300.00', cost: '0.00', description: 'Procedimento odontol√≥gico restaurador/dent√≠stica conforme indica√ß√£o: Dent√≠stica - restaura√ß√£o com resina 2 faces.', duration: 60, category: 'Restaurador' },
    { name: 'Dent√≠stica - restaura√ß√£o com resina 3 faces', code: '033', price: '350.00', cost: '0.00', description: 'Procedimento odontol√≥gico restaurador/dent√≠stica conforme indica√ß√£o: Dent√≠stica - restaura√ß√£o com resina 3 faces.', duration: 60, category: 'Restaurador' },
    { name: 'Dent√≠stica - restaura√ß√£o com resina 4 faces', code: '034', price: '400.00', cost: '0.00', description: 'Procedimento odontol√≥gico restaurador/dent√≠stica conforme indica√ß√£o: Dent√≠stica - restaura√ß√£o com resina 4 faces.', duration: 60, category: 'Restaurador' },
    { name: 'Dent√≠stica - restaura√ß√£o com resina 5 faces', code: '035', price: '450.00', cost: '0.00', description: 'Procedimento odontol√≥gico restaurador/dent√≠stica conforme indica√ß√£o: Dent√≠stica - restaura√ß√£o com resina 5 faces.', duration: 60, category: 'Restaurador' },
    { name: 'Dent√≠stica - restaura√ß√£o com resina 6 faces', code: '036', price: '500.00', cost: '0.00', description: 'Procedimento odontol√≥gico restaurador/dent√≠stica conforme indica√ß√£o: Dent√≠stica - restaura√ß√£o com resina 6 faces.', duration: 60, category: 'Restaurador' },
    { name: 'Dent√≠stica - restaura√ß√£o com resina anterior', code: '037', price: '350.00', cost: '0.00', description: 'Procedimento odontol√≥gico restaurador/dent√≠stica conforme indica√ß√£o: Dent√≠stica - restaura√ß√£o com resina anterior.', duration: 60, category: 'Restaurador' },
    { name: 'Dent√≠stica - restaura√ß√£o com resina posterior', code: '038', price: '350.00', cost: '0.00', description: 'Procedimento odontol√≥gico restaurador/dent√≠stica conforme indica√ß√£o: Dent√≠stica - restaura√ß√£o com resina posterior.', duration: 60, category: 'Restaurador' },
    { name: 'Dent√≠stica - restaura√ß√£o provis√≥ria', code: '039', price: '150.00', cost: '0.00', description: 'Procedimento odontol√≥gico restaurador/dent√≠stica conforme indica√ß√£o: Dent√≠stica - restaura√ß√£o provis√≥ria.', duration: 60, category: 'Restaurador' },
    { name: 'Diagn√≥stico de Bruxismo', code: '040', price: '250.00', cost: '0.00', description: 'Avalia√ß√£o cl√≠nica, anamnese e orienta√ß√£o/planejamento odontol√≥gico: Diagn√≥stico de Bruxismo.', duration: 60, category: 'Diagn√≥stico' },
    { name: 'Endodontia - retratamento (incisivo/canino)', code: '041', price: '750.00', cost: '0.00', description: 'Procedimento endod√¥ntico realizado conforme indica√ß√£o: Endodontia - retratamento (incisivo/canino).', duration: 60, category: 'Endodontia' },
    { name: 'Endodontia - retratamento (pr√©-molar)', code: '042', price: '850.00', cost: '0.00', description: 'Procedimento endod√¥ntico realizado conforme indica√ß√£o: Endodontia - retratamento (pr√©-molar).', duration: 60, category: 'Endodontia' },
    { name: 'Endodontia - retratamento (molar)', code: '043', price: '950.00', cost: '0.00', description: 'Procedimento endod√¥ntico realizado conforme indica√ß√£o: Endodontia - retratamento (molar).', duration: 60, category: 'Endodontia' },
    { name: 'Endodontia - tratamento (incisivo/canino)', code: '044', price: '650.00', cost: '0.00', description: 'Procedimento endod√¥ntico realizado conforme indica√ß√£o: Endodontia - tratamento (incisivo/canino).', duration: 60, category: 'Endodontia' },
    { name: 'Endodontia - tratamento (pr√©-molar)', code: '045', price: '750.00', cost: '0.00', description: 'Procedimento endod√¥ntico realizado conforme indica√ß√£o: Endodontia - tratamento (pr√©-molar).', duration: 60, category: 'Endodontia' },
    { name: 'Endodontia - tratamento (molar)', code: '046', price: '850.00', cost: '0.00', description: 'Procedimento endod√¥ntico realizado conforme indica√ß√£o: Endodontia - tratamento (molar).', duration: 60, category: 'Endodontia' },
    { name: 'Enxerto √≥sseo', code: '047', price: '1200.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Enxerto √≥sseo.', duration: 60, category: 'Cirurgia' },
    { name: 'Exodontia simples', code: '048', price: '300.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Exodontia simples.', duration: 60, category: 'Cirurgia' },
    { name: 'Exodontia complexa', code: '049', price: '450.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Exodontia complexa.', duration: 60, category: 'Cirurgia' },
    { name: 'Faceta em resina', code: '050', price: '450.00', cost: '0.00', description: 'Procedimento est√©tico odontol√≥gico conforme indica√ß√£o: Faceta em resina.', duration: 60, category: 'Est√©tica' },
    { name: 'Faceta em porcelana', code: '051', price: '1800.00', cost: '0.00', description: 'Procedimento est√©tico odontol√≥gico conforme indica√ß√£o: Faceta em porcelana.', duration: 60, category: 'Est√©tica' },
    { name: 'Frenectomia labial', code: '052', price: '450.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Frenectomia labial.', duration: 60, category: 'Cirurgia' },
    { name: 'Frenectomia lingual', code: '053', price: '450.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Frenectomia lingual.', duration: 60, category: 'Cirurgia' },
    { name: 'Gengivoplastia', code: '054', price: '450.00', cost: '0.00', description: 'Exame de imagem para avalia√ß√£o e planejamento odontol√≥gico: Gengivoplastia.', duration: 60, category: 'Profilaxia & Periodontia' },
    { name: 'Hemissec√ß√£o', code: '055', price: '450.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Hemissec√ß√£o.', duration: 60, category: 'Cirurgia' },
    { name: 'Implante unit√°rio', code: '056', price: '3500.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Implante unit√°rio.', duration: 60, category: 'Cirurgia' },
    { name: 'Implante protocolo', code: '057', price: '15000.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Implante protocolo.', duration: 60, category: 'Cirurgia' },
    { name: 'Implante m√∫ltiplo', code: '058', price: '6500.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Implante m√∫ltiplo.', duration: 60, category: 'Cirurgia' },
    { name: 'Limpeza (profilaxia)', code: '059', price: '200.00', cost: '0.00', description: 'Exame de imagem para avalia√ß√£o e planejamento odontol√≥gico: Limpeza (profilaxia).', duration: 60, category: 'Profilaxia & Periodontia' },
    { name: 'Manuten√ß√£o de aparelho', code: '060', price: '150.00', cost: '0.00', description: 'Procedimento ortod√¥ntico realizado conforme indica√ß√£o: Manuten√ß√£o de aparelho.', duration: 60, category: 'Ortodontia' },
    { name: 'Manuten√ß√£o de conten√ß√£o', code: '061', price: '150.00', cost: '0.00', description: 'Procedimento ortod√¥ntico realizado conforme indica√ß√£o: Manuten√ß√£o de conten√ß√£o.', duration: 60, category: 'Ortodontia' },
    { name: 'Manuten√ß√£o periodontal', code: '062', price: '250.00', cost: '0.00', description: 'Exame de imagem para avalia√ß√£o e planejamento odontol√≥gico: Manuten√ß√£o periodontal.', duration: 60, category: 'Profilaxia & Periodontia' },
    { name: 'Odontopediatria - consulta', code: '063', price: '200.00', cost: '0.00', description: 'Avalia√ß√£o cl√≠nica, anamnese e orienta√ß√£o/planejamento odontol√≥gico: Odontopediatria - consulta.', duration: 60, category: 'Odontopediatria' },
    { name: 'Odontopediatria - aplica√ß√£o fl√∫or', code: '064', price: '150.00', cost: '0.00', description: 'Procedimento preventivo para controle de placa, c√°rie e sa√∫de bucal: Odontopediatria - aplica√ß√£o fl√∫or.', duration: 60, category: 'Odontopediatria' },
    { name: 'Odontopediatria - selante', code: '065', price: '250.00', cost: '0.00', description: 'Procedimento preventivo para controle de placa, c√°rie e sa√∫de bucal: Odontopediatria - selante.', duration: 60, category: 'Odontopediatria' },
    { name: 'Odontopediatria - restaura√ß√£o', code: '066', price: '250.00', cost: '0.00', description: 'Procedimento odontol√≥gico restaurador/dent√≠stica conforme indica√ß√£o: Odontopediatria - restaura√ß√£o.', duration: 60, category: 'Odontopediatria' },
    { name: 'Ortodontia - documenta√ß√£o', code: '067', price: '450.00', cost: '0.00', description: 'Avalia√ß√£o cl√≠nica, anamnese e orienta√ß√£o/planejamento odontol√≥gico: Ortodontia - documenta√ß√£o.', duration: 60, category: 'Ortodontia' },
    { name: 'Ortodontia - instala√ß√£o aparelho', code: '068', price: '1200.00', cost: '0.00', description: 'Procedimento ortod√¥ntico realizado conforme indica√ß√£o: Ortodontia - instala√ß√£o aparelho.', duration: 60, category: 'Ortodontia' },
    { name: 'Ortodontia - aparelho m√≥vel', code: '069', price: '950.00', cost: '0.00', description: 'Procedimento ortod√¥ntico realizado conforme indica√ß√£o: Ortodontia - aparelho m√≥vel.', duration: 60, category: 'Ortodontia' },
    { name: 'Ortodontia - conten√ß√£o', code: '070', price: '650.00', cost: '0.00', description: 'Procedimento ortod√¥ntico realizado conforme indica√ß√£o: Ortodontia - conten√ß√£o.', duration: 60, category: 'Ortodontia' },
    { name: 'Ortodontia - alinhadores', code: '071', price: '6500.00', cost: '0.00', description: 'Procedimento ortod√¥ntico realizado conforme indica√ß√£o: Ortodontia - alinhadores.', duration: 60, category: 'Ortodontia' },
    { name: 'PPR (pr√≥tese parcial remov√≠vel)', code: '072', price: '1600.00', cost: '0.00', description: 'Procedimento odontol√≥gico relacionado a pr√≥tese/reabilita√ß√£o e moldagem: PPR (pr√≥tese parcial remov√≠vel).', duration: 60, category: 'Pr√≥tese & Moldagem' },
    { name: 'PPF (pr√≥tese fixa)', code: '073', price: '1800.00', cost: '0.00', description: 'Procedimento odontol√≥gico relacionado a pr√≥tese/reabilita√ß√£o e moldagem: PPF (pr√≥tese fixa).', duration: 60, category: 'Pr√≥tese & Moldagem' },
    { name: 'Placa de clareamento', code: '074', price: '250.00', cost: '0.00', description: 'Procedimento est√©tico odontol√≥gico conforme indica√ß√£o: Placa de clareamento.', duration: 60, category: 'Est√©tica' },
    { name: 'Placa de bruxismo', code: '075', price: '650.00', cost: '0.00', description: 'Procedimento odontol√≥gico relacionado a pr√≥tese/reabilita√ß√£o e moldagem: Placa de bruxismo.', duration: 60, category: 'Pr√≥tese & Moldagem' },
    { name: 'Ponte fixa', code: '076', price: '3500.00', cost: '0.00', description: 'Procedimento odontol√≥gico relacionado a pr√≥tese/reabilita√ß√£o e moldagem: Ponte fixa.', duration: 60, category: 'Pr√≥tese & Moldagem' },
    { name: 'Pr√≥tese total', code: '077', price: '2500.00', cost: '0.00', description: 'Procedimento odontol√≥gico relacionado a pr√≥tese/reabilita√ß√£o e moldagem: Pr√≥tese total.', duration: 60, category: 'Pr√≥tese & Moldagem' },
    { name: 'Raspagem subgengival (por quadrante)', code: '078', price: '350.00', cost: '0.00', description: 'Exame de imagem para avalia√ß√£o e planejamento odontol√≥gico: Raspagem subgengival (por quadrante).', duration: 60, category: 'Profilaxia & Periodontia' },
    { name: 'Raspagem supragengival', code: '079', price: '250.00', cost: '0.00', description: 'Exame de imagem para avalia√ß√£o e planejamento odontol√≥gico: Raspagem supragengival.', duration: 60, category: 'Profilaxia & Periodontia' },
    { name: 'Remo√ß√£o de c√°lculo', code: '080', price: '200.00', cost: '0.00', description: 'Exame de imagem para avalia√ß√£o e planejamento odontol√≥gico: Remo√ß√£o de c√°lculo.', duration: 60, category: 'Profilaxia & Periodontia' },
    { name: 'Retratamento endod√¥ntico', code: '081', price: '850.00', cost: '0.00', description: 'Procedimento endod√¥ntico realizado conforme indica√ß√£o: Retratamento endod√¥ntico.', duration: 60, category: 'Endodontia' },
    { name: 'Restaura√ß√£o em ion√¥mero', code: '082', price: '250.00', cost: '0.00', description: 'Procedimento odontol√≥gico restaurador/dent√≠stica conforme indica√ß√£o: Restaura√ß√£o em ion√¥mero.', duration: 60, category: 'Restaurador' },
    { name: 'Restaura√ß√£o em resina', code: '083', price: '250.00', cost: '0.00', description: 'Procedimento odontol√≥gico restaurador/dent√≠stica conforme indica√ß√£o: Restaura√ß√£o em resina.', duration: 60, category: 'Restaurador' },
    { name: 'Restaura√ß√£o provis√≥ria', code: '084', price: '150.00', cost: '0.00', description: 'Procedimento odontol√≥gico restaurador/dent√≠stica conforme indica√ß√£o: Restaura√ß√£o provis√≥ria.', duration: 60, category: 'Restaurador' },
    { name: 'Reembasamento de pr√≥tese', code: '085', price: '450.00', cost: '0.00', description: 'Procedimento odontol√≥gico relacionado a pr√≥tese/reabilita√ß√£o e moldagem: Reembasamento de pr√≥tese.', duration: 60, category: 'Pr√≥tese & Moldagem' },
    { name: 'Remo√ß√£o de t√°rtaro', code: '086', price: '200.00', cost: '0.00', description: 'Exame de imagem para avalia√ß√£o e planejamento odontol√≥gico: Remo√ß√£o de t√°rtaro.', duration: 60, category: 'Profilaxia & Periodontia' },
    { name: 'Urg√™ncia - consulta', code: '087', price: '250.00', cost: '0.00', description: 'Avalia√ß√£o cl√≠nica, anamnese e orienta√ß√£o/planejamento odontol√≥gico: Urg√™ncia - consulta.', duration: 60, category: 'Diagn√≥stico' },
    { name: 'Urg√™ncia - curativo', code: '088', price: '200.00', cost: '0.00', description: 'Avalia√ß√£o cl√≠nica, anamnese e orienta√ß√£o/planejamento odontol√≥gico: Urg√™ncia - curativo.', duration: 60, category: 'Diagn√≥stico' },
    { name: 'Urg√™ncia - drenagem', code: '089', price: '300.00', cost: '0.00', description: 'Avalia√ß√£o cl√≠nica, anamnese e orienta√ß√£o/planejamento odontol√≥gico: Urg√™ncia - drenagem.', duration: 60, category: 'Diagn√≥stico' },
    { name: 'Urg√™ncia - medica√ß√£o', code: '090', price: '150.00', cost: '0.00', description: 'Avalia√ß√£o cl√≠nica, anamnese e orienta√ß√£o/planejamento odontol√≥gico: Urg√™ncia - medica√ß√£o.', duration: 60, category: 'Diagn√≥stico' },
    { name: 'Urg√™ncia - abertura endod√¥ntica', code: '091', price: '350.00', cost: '0.00', description: 'Procedimento endod√¥ntico realizado conforme indica√ß√£o: Urg√™ncia - abertura endod√¥ntica.', duration: 60, category: 'Endodontia' },
    { name: 'Urg√™ncia - restaura√ß√£o provis√≥ria', code: '092', price: '200.00', cost: '0.00', description: 'Procedimento odontol√≥gico restaurador/dent√≠stica conforme indica√ß√£o: Urg√™ncia - restaura√ß√£o provis√≥ria.', duration: 60, category: 'Restaurador' },
    { name: 'Urg√™ncia - ajuste oclusal', code: '093', price: '200.00', cost: '0.00', description: 'Exame de imagem para avalia√ß√£o e planejamento odontol√≥gico: Urg√™ncia - ajuste oclusal.', duration: 60, category: 'Profilaxia & Periodontia' },
    { name: 'Urg√™ncia - exodontia', code: '094', price: '350.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Urg√™ncia - exodontia.', duration: 60, category: 'Cirurgia' },
    { name: 'Urg√™ncia - sutura', code: '095', price: '250.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Urg√™ncia - sutura.', duration: 60, category: 'Cirurgia' },
    { name: 'Urg√™ncia - remo√ß√£o de ponto', code: '096', price: '100.00', cost: '0.00', description: 'Procedimento cir√∫rgico odontol√≥gico realizado conforme indica√ß√£o e protocolo cl√≠nico: Urg√™ncia - remo√ß√£o de ponto.', duration: 60, category: 'Cirurgia' },
    { name: 'Exame Laboratorial (solicita√ß√£o/avalia√ß√£o)', code: '097', price: '150.00', cost: '0.00', description: 'Exames e testes para apoio diagn√≥stico odontol√≥gico: Exame Laboratorial (solicita√ß√£o/avalia√ß√£o).', duration: 60, category: 'Diagn√≥stico' },
    { name: 'Teste de sensibilidade pulpar', code: '098', price: '100.00', cost: '0.00', description: 'Exames e testes para apoio diagn√≥stico odontol√≥gico: Teste de sensibilidade pulpar.', duration: 60, category: 'Diagn√≥stico' },
    { name: 'Teste de oclus√£o', code: '099', price: '100.00', cost: '0.00', description: 'Exames e testes para apoio diagn√≥stico odontol√≥gico: Teste de oclus√£o.', duration: 60, category: 'Diagn√≥stico' },
    { name: 'Teste de saliva', code: '100', price: '100.00', cost: '0.00', description: 'Exames e testes para apoio diagn√≥stico odontol√≥gico: Teste de saliva.', duration: 60, category: 'Diagn√≥stico' },
];

const DEFAULT_INVENTORY = [
    { name: 'Fio de Sutura Seda', category: 'Cirurgia', quantity: 0, unit: 'Caixa (24un)', minLevel: 0 },
    { name: 'Papel Articular', category: 'Restaurador', quantity: 0, unit: 'Bloco', minLevel: 0 },
    { name: 'Alveol√≥tomo', category: 'Cirurgia', quantity: 0, unit: 'un', minLevel: 0 },
    { name: 'Alginato (454g)', category: 'Pr√≥tese & Moldagem', quantity: 0, unit: 'un (pacote)', minLevel: 0 },
    { name: 'Gaze Est√©ril', category: 'Descart√°veis', quantity: 0, unit: 'un', minLevel: 0 },
    { name: 'Luva Cir√∫rgica Est√©ril', category: 'Biosseguran√ßa', quantity: 0, unit: 'par', minLevel: 0 },
    { name: 'Cariost√°tico', category: 'Preventivo', quantity: 0, unit: 'ml', minLevel: 0 },
    { name: 'Anest√©sico T√≥pico (Benzoca√≠na)', category: 'Anestesia', quantity: 0, unit: 'Pote', minLevel: 0 },
    { name: 'Selante Resinoso', category: 'Restaurador', quantity: 0, unit: 'seringa', minLevel: 0 },
    { name: 'Indicador Biol√≥gico (Teste Autoclave)', category: 'Esteriliza√ß√£o', quantity: 0, unit: 'Caixa (10un)', minLevel: 0 },
    { name: 'Broca Diamantada Cil√≠ndrica', category: 'Instrumentais Rotat√≥rios', quantity: 0, unit: 'Unidade', minLevel: 0 },
    { name: 'Mini-implante Ortod√¥ntico', category: 'Ortodontia', quantity: 0, unit: 'un', minLevel: 0 },
    { name: 'Alginato', category: 'Pr√≥tese & Moldagem', quantity: 0, unit: 'Pacote', minLevel: 0 },
    { name: 'Br√°quetes Met√°licos (Caso)', category: 'Ortodontia', quantity: 0, unit: 'Cartela', minLevel: 0 },
    { name: 'Fio Dental Profissional', category: 'Profilaxia & Periodontia', quantity: 0, unit: 'm', minLevel: 0 },
    { name: 'Hipoclorito de S√≥dio 2.5% e 5%', category: 'Endodontia', quantity: 0, unit: 'ml', minLevel: 0 },
    { name: 'Selante Resinoso', category: 'Restaurador', quantity: 0, unit: 'ml', minLevel: 0 },
    { name: 'Soro Fisiol√≥gico 0.9%', category: 'Solu√ß√µes', quantity: 0, unit: 'ml', minLevel: 0 },
    { name: 'Ta√ßa de Borracha / Escova Robson', category: 'Profilaxia & Periodontia', quantity: 0, unit: 'un', minLevel: 0 },
    { name: '√Åcido Fosf√≥rico 37%', category: 'Restaurador', quantity: 0, unit: 'un (seringa)', minLevel: 0 },
    { name: 'Broca Transmetal', category: 'Instrumentais Rotat√≥rios', quantity: 0, unit: 'Unidade', minLevel: 0 },
    { name: 'G√°s Oz√¥nio (Cilindro O3)', category: 'Equipamentos & Gases', quantity: 0, unit: 'un', minLevel: 0 },
    { name: 'Silicone de Condensa√ß√£o (Kit)', category: 'Pr√≥tese & Moldagem', quantity: 0, unit: 'Kit', minLevel: 0 },
    { name: 'Filme Periapical (Adulto/Infantil)', category: 'Radiologia', quantity: 0, unit: 'un', minLevel: 0 },
    { name: 'Pasta Profil√°tica', category: 'Profilaxia & Periodontia', quantity: 0, unit: 'Bisnaga', minLevel: 0 },
    { name: 'M√°scara N95/PFF2', category: 'Biosseguran√ßa', quantity: 0, unit: 'Unidade', minLevel: 0 },
    { name: 'Seringa Insulina', category: 'Descart√°veis', quantity: 0, unit: 'unidade', minLevel: 0 },
    { name: 'Matriz de Poli√©ster', category: 'Restaurador', quantity: 0, unit: 'Caixa (50un)', minLevel: 0 },
    { name: 'Posicionador Radiogr√°fico', category: 'Radiologia', quantity: 0, unit: 'Kit', minLevel: 0 },
    { name: 'Silano', category: 'Restaurador', quantity: 0, unit: 'ml', minLevel: 0 },
    { name: 'Arcos Ortod√¥nticos (NiTi/A√ßo)', category: 'Ortodontia', quantity: 0, unit: 'un', minLevel: 0 },
    { name: 'Fio de Sutura Nylon', category: 'Cirurgia', quantity: 0, unit: 'Caixa (24un)', minLevel: 0 },
    { name: 'Resina Ortod√¥ntica (Transbond)', category: 'Ortodontia', quantity: 0, unit: 'un', minLevel: 0 },
    { name: 'Silano', category: 'Restaurador', quantity: 0, unit: 'Frasco', minLevel: 0 },
    { name: 'Fita Indicadora de pH Salivar', category: 'Diagn√≥stico', quantity: 0, unit: 'un', minLevel: 0 },
    { name: 'Bolinha de Algod√£o', category: 'Descart√°veis', quantity: 0, unit: 'Pacote (500g)', minLevel: 0 },
    { name: 'C√¢nulas de Preenchimento (22G/25G)', category: 'HOF', quantity: 0, unit: 'un', minLevel: 0 },
    { name: 'Toxina Botul√≠nica (50U/100U)', category: 'HOF', quantity: 0, unit: 'Frasco', minLevel: 0 },
    { name: 'Fio Retrator Gengival', category: 'Profilaxia & Periodontia', quantity: 0, unit: 'cm', minLevel: 0 },
    { name: 'Filme Periapical Adulto', category: 'Radiologia', quantity: 0, unit: 'Caixa', minLevel: 0 },
    { name: 'Resina Esmalte A1', category: 'Restaurador', quantity: 0, unit: 'Tubo 4g', minLevel: 0 },
    { name: 'Silicone de Adi√ß√£o (Kit)', category: 'Pr√≥tese & Moldagem', quantity: 0, unit: 'Kit', minLevel: 0 },
    { name: 'Papel Grau Cir√∫rgico 10cm', category: 'Esteriliza√ß√£o', quantity: 0, unit: 'Rolo', minLevel: 0 },
    { name: 'Seringas (1/3/5/10/20ml)', category: 'Descart√°veis', quantity: 0, unit: 'un', minLevel: 0 },
    { name: 'Per√≥xido (Hidrog√™nio/Carbamida)', category: 'Est√©tica', quantity: 0, unit: 'ml', minLevel: 0 },
    { name: 'Silano', category: 'Restaurador', quantity: 0, unit: 'ml', minLevel: 0 },
    { name: 'Seringa Insulina/Aplica√ß√£o', category: 'Descart√°veis', quantity: 0, unit: 'Pacote', minLevel: 0 },
    { name: 'Rolete de Algod√£o', category: 'Descart√°veis', quantity: 0, unit: 'unidade', minLevel: 0 },
    { name: 'Tira de Lixa (A√ßo/Poli√©ster)', category: 'Restaurador', quantity: 0, unit: 'un', minLevel: 0 },
    { name: 'Vaselina S√≥lida', category: 'Auxiliares', quantity: 0, unit: 'g', minLevel: 0 },
    { name: 'Luva de Procedimento (PP/P/M/G)', category: 'Biosseguran√ßa', quantity: 0, unit: 'par', minLevel: 0 },
    { name: 'Resina Composta (Esm/Dent/Flow)', category: 'Restaurador', quantity: 0, unit: 'g', minLevel: 0 },
    { name: 'Dessensibilizante Dent√°rio', category: 'Restaurador', quantity: 0, unit: 'ml', minLevel: 0 },
    { name: 'Silicone Adi√ß√£o / Condensa√ß√£o', category: 'Pr√≥tese & Moldagem', quantity: 0, unit: 'ml', minLevel: 0 },
    { name: '√Åcido Deoxic√≥lico (Enzima de Papada)', category: 'HOF', quantity: 0, unit: 'ml', minLevel: 0 },
    { name: 'Silicone de Adi√ß√£o', category: 'Pr√≥tese & Moldagem', quantity: 0, unit: 'ml', minLevel: 0 },
    { name: 'Agulha de Irriga√ß√£o Endo', category: 'Endodontia', quantity: 0, unit: 'Pacote', minLevel: 0 },
    { name: '√Åcido Hialur√¥nico', category: 'HOF', quantity: 0, unit: 'Seringa', minLevel: 0 },
    { name: 'Esponja Hemost√°tica', category: 'Cirurgia', quantity: 0, unit: 'un', minLevel: 0 },
    { name: 'Fl√∫or Verniz', category: 'Preventivo', quantity: 0, unit: 'Frasco/Dose', minLevel: 0 },
];

export const seedDefaultData = async (organizationId: string) => {
    console.log(`üå± Seeding default data for organization ${organizationId}...`);

    try {
        // Check if data already exists to avoid duplication
        const existingProcedures = await db.select().from(procedures).where(eq(procedures.organizationId, organizationId)).limit(1);

        if (existingProcedures.length > 0) {
            console.log(`‚ö†Ô∏è Data already exists for org ${organizationId}, skipping seed.`);
            return { success: true, skipped: true };
        }

        // 1. Procedimentos via Template OU Fallback
        let procsToInsert: any[] = [];

        try {
            const tProcs = await db.select().from(templateProcedures);
            if (tProcs.length > 0) {
                procsToInsert = tProcs.map(t => ({
                    name: t.name,
                    description: t.description,
                    category: t.category,
                    price: t.price,
                    duration: t.duration,
                    organizationId,
                }));
                console.log(`‚úÖ Fetched ${procsToInsert.length} procedures from DB templates`);
            }
        } catch (err) {
            console.warn('‚ö†Ô∏è Could not fetch from template_procedures table, using fallback.', err);
        }

        // Se vazia, usa hardcoded
        if (procsToInsert.length === 0) {
            console.log('Using hardcoded default procedures.');
            procsToInsert = DEFAULT_PROCEDURES.map(p => ({
                name: p.name,
                description: p.description,
                category: p.category,
                price: p.price,
                duration: p.duration,
                code: (p as any).code,
                cost: (p as any).cost,
                organizationId
            }));
        }

        if (procsToInsert.length > 0) {
            await db.insert(procedures).values(procsToInsert);
            console.log(`‚úÖ ${procsToInsert.length} procedures inserted.`);
        }

        // 2. Estoque via Template OU Fallback
        let invToInsert: any[] = [];

        try {
            const tInv = await db.select().from(templateInventory);
            if (tInv.length > 0) {
                invToInsert = tInv.map(t => ({
                    name: t.name,
                    category: t.category,
                    quantity: t.quantity,
                    minQuantity: t.minQuantity,
                    unit: t.unit,
                    price: t.price,
                    supplier: t.supplier,
                    link: t.link,
                    organizationId,
                }));
                console.log(`‚úÖ Fetched ${invToInsert.length} inventory items from DB templates`);
            }
        } catch (err) {
            console.warn('‚ö†Ô∏è Could not fetch from template_inventory table, using fallback.', err);
        }

        // Fallback
        if (invToInsert.length === 0) {
            console.log('Using hardcoded default inventory.');
            invToInsert = DEFAULT_INVENTORY.map(i => ({
                name: i.name,
                category: i.category,
                quantity: i.quantity,
                minQuantity: (i as any).minLevel || (i as any).minQuantity || 0,
                unit: i.unit,
                price: (i as any).price,
                organizationId
            }));
        }

        if (invToInsert.length > 0) {
            await db.insert(inventory).values(invToInsert);
            console.log(`‚úÖ ${invToInsert.length} inventory items inserted.`);
        }

        // 3. Pacientes de Exemplo
        const defaultPatients = [
            {
                name: 'Maria Silva (Exemplo)',
                phone: '11999999999',
                cpf: '12345678900',
                email: 'maria.exemplo@email.com',
                organizationId,
                createdAt: new Date(),
            },
            {
                name: 'Jo√£o Santos (Exemplo)',
                phone: '11888888888',
                cpf: '98765432100',
                email: 'joao.exemplo@email.com',
                organizationId,
                createdAt: new Date(),
            }
        ];

        await db.insert(patients).values(defaultPatients);
        console.log('‚úÖ Default patients created');

        return { success: true };
    } catch (error) {
        console.error('‚ùå Error seeding default data:', error);
        // N√£o lan√ßa erro para n√£o bloquear o onboarding se o seed falhar
        return { success: false, error };
    }
};
